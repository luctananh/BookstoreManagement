@model BookStore1.Models.ShoppingCart
@using System.Globalization

<li class="cart-dropdown dropdown">
    <a asp-controller="ShoppingCart" asp-action="Index" class="dropdown-toggle" data-bs-toggle="dropdown" role="button"
        aria-expanded="false">
        <svg class="cart">
            <use xlink:href="#cart"></use>
        </svg>
        <span class="fs-6 fw-light">
            (@(Model != null && Model.ShoppingCartItems != null ? Model.ShoppingCartItems.Sum(item => item.Quantity) : 0))
        </span>
    </a>
    <div class="dropdown-menu animate slide dropdown-menu-start dropdown-menu-lg-end p-3">
        <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-primary">Your cart</span>
            <span class="badge bg-primary rounded-pill">
                @(Model != null && Model.ShoppingCartItems != null ? Model.ShoppingCartItems.Sum(item => item.Quantity) : 0)
            </span>
        </h4>
        <ul class="list-group mb-3">
            @if (Model != null && Model.ShoppingCartItems != null && Model.ShoppingCartItems.Any())
            {
                @foreach (var item in Model.ShoppingCartItems.Take(3)) // Take up to 3 items
                {
                    <li class="list-group-item bg-transparent d-flex justify-content-between lh-sm">
                        <div>
                            @if (!string.IsNullOrEmpty(item.Book.ImageUrl))
                            {
                                <img src="@item.Book.ImageUrl" alt="@item.Book.Title" style="width: 30px; height: 45px; margin-right: 5px;" />
                            }
                            else
                            {
                                <img src="~/images/placeholder.png" alt="No Image" style="width: 30px; height: 45px; margin-right: 5px;" />
                            }
                            <h5>
                                <a href="#">@item.Book.Title</a>
                            </h5>
                            <small>Quantity: @item.Quantity</small>
                        </div>
                        <span class="text-primary">@item.Price.ToString("C", new CultureInfo("en-US"))</span>
                    </li>
                }
                @if (Model.ShoppingCartItems.Count() > 3)
                {
                    <li class="list-group-item bg-transparent d-flex justify-content-between lh-sm">
                        <div>
                            <small>... and @(Model.ShoppingCartItems.Count() - 3) more items</small>
                        </div>
                    </li>
                }
            }
            else
            {
                <li class="list-group-item bg-transparent d-flex justify-content-between lh-sm">
                    <div>
                        <small>Your cart is empty.</small>
                    </div>
                </li>
            }
            <li class="list-group-item bg-transparent d-flex justify-content-between">
                <span class="text-capitalize"><b>Total (USD)</b></span>
                <strong>@(Model != null && Model.ShoppingCartItems != null ? Model.ShoppingCartItems.Sum(item => item.Quantity * item.Price).ToString("C", new CultureInfo("en-US")) : (0M).ToString("C", new CultureInfo("en-US")))</strong>
            </li>
        </ul>
        <div class="d-flex flex-wrap justify-content-center">
            <a asp-controller="ShoppingCart" asp-action="Index" class="w-100 btn btn-dark mb-1">View Cart</a>
            <a href="#" class="w-100 btn btn-primary" type="submit">Go to checkout</a>
        </div>
    </div>
</li>